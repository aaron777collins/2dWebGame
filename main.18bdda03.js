(()=>{"use strict";var t,e={196:(t,e,i)=>{i.d(e,{o:()=>D});var n=i(365),a=i(131),o=i(643),s=i(138),r=i(221),c=i(122),l=i(188),m=i(881),d=i(466),p=i.n(d);const h={idle:{startFrame:0,endFrame:5,framesMissing:0},idleRight:{startFrame:6,endFrame:11,framesMissing:0},idleBack:{startFrame:12,endFrame:17,framesMissing:0},walk:{startFrame:18,endFrame:23,framesMissing:0},walkRight:{startFrame:24,endFrame:29,framesMissing:0},walkBack:{startFrame:30,endFrame:35,framesMissing:0},attack:{startFrame:36,endFrame:41,framesMissing:2},attackRight:{startFrame:42,endFrame:47,framesMissing:2},attackBack:{startFrame:48,endFrame:53,framesMissing:2},die:{startFrame:54,endFrame:59,framesMissing:3},mostRecentDirection:"normal",currentAnimation:"idle",previousAnimation:"",animationElapsedTime:0,animationDuration:100,animationTimeOffset:0,x_tiles:6,y_tiles:10};class u{constructor(t){this.character=t}updateAnimations(){this.updateCharacterAnimation()}updateCharacterAnimation(){h.previousAnimation!==h.currentAnimation&&(h.animationTimeOffset=-D.domElement.ownerDocument.defaultView.performance.now()),h.previousAnimation=h.currentAnimation;const t=h[h.currentAnimation];if(t&&(h.animationElapsedTime+=h.animationTimeOffset+D.domElement.ownerDocument.defaultView.performance.now(),h.animationElapsedTime>=h.animationDuration)){const e=t.startFrame,i=t.endFrame,n=(e+Math.floor(h.animationElapsedTime/h.animationDuration)-1)%(i-e+1);if(n>=i-e+1-t.framesMissing)return this.character.attacking=!1,"right"===h.mostRecentDirection?h.currentAnimation="idleRight":"back"===h.mostRecentDirection?h.currentAnimation="idleBack":h.currentAnimation="idle",void this.updateCharacterAnimation();this.character.flipped?(this.character.sprite.material.map=this.character.textures[i-n],this.character.sprite.material.map.offset.x=-1*Math.abs(this.character.sprite.material.map.offset.x),this.character.sprite.material.map.repeat.x=-1*Math.abs(this.character.sprite.material.map.repeat.x)):(this.character.sprite.material.map=this.character.textures[e+n],this.character.sprite.material.map.offset.x=Math.abs(this.character.sprite.material.map.offset.x),this.character.sprite.material.map.repeat.x=Math.abs(this.character.sprite.material.map.repeat.x)),this.character.sprite.material.needsUpdate=!0,h.animationElapsedTime=0}}}var w=i(661);function f(t,e,i,n=!1){const a=[];for(let n=0;n<i;n++)for(let o=e-1;o>=0;o--){const s=t.clone();s.needsUpdate=!0,s.repeat.set(1/e,1/i),s.offset.set(o/e,n/i),a.push(s)}return a}const k=100;class y{constructor(t,e){this.blockAnimation=t,this.blockType=e}setSprite(t){this.sprite=t}updateBlock(){this.blockAnimation.updateAnimation(this.sprite)}}var x;!function(t){t[t.Solid=0]="Solid",t[t.NonSolid=1]="NonSolid",t[t.NonSolidAndNonVisible=2]="NonSolidAndNonVisible",t[t.NonSolidAndNonVisibleAndNonCollidable=3]="NonSolidAndNonVisibleAndNonCollidable"}(x||(x={}));class g{constructor(t,e,i,n,a){this.startFrame=t,this.endFrame=e,this.framesMissing=i,this.animationElapsedTime=0,this.animationDuration=n,this.animationTimeOffset=0,this.textures=a}updateAnimation(t){const e={startFrame:this.startFrame,endFrame:this.endFrame,framesMissing:this.framesMissing};if(e){if(!this.textures)throw console.log("No block textures"),new Error("No block textures");if(this.animationElapsedTime+=this.animationTimeOffset+D.domElement.ownerDocument.defaultView.performance.now(),this.animationElapsedTime>=this.animationDuration){const i=e.startFrame,n=e.endFrame,a=(i+Math.floor(this.animationElapsedTime/this.animationDuration)-1)%(n-i+1);if(a>=n-i+1-e.framesMissing)return this.animationElapsedTime=0,void this.updateAnimation(t);this.texture=this.textures[i+a],this.texture.offset.x=Math.abs(this.texture.offset.x),this.texture.repeat.x=Math.abs(this.texture.repeat.x),this.texture.needsUpdate=!0,this.animationElapsedTime=0,t.material.map=this.texture}}}}let b,A=0,v=0;const M=new class{constructor(){this.blockAnimationMap=new Map,this.blockTypeMap=new Map,this.blocks=[],this.solidBlocksInstances=[],this.blockInstances=[]}createBlock(t,e){const i=new y(t,e);return this.blocks.push(i),i}updateBlocks(){for(const t of this.blocks)t.updateBlock()}async createBlockAnimationMap(){let t=new Promise(((t,e)=>{(new r.d).load("static/blocks.png",(function(e){t(e)}))}));const e=f(await t,5,3).reverse();e.forEach((t=>{t.wrapS=w.rpg}));const i=new g(0,4,0,1e3,e);this.blockAnimationMap.set("grass1",i);const n=new g(5,9,0,1e3,e);this.blockAnimationMap.set("grass2",n);const a=new g(10,14,0,1e3,e);this.blockAnimationMap.set("stone1",a)}createBlockTypeMap(){this.blockTypeMap.set("grass1",x.NonSolid),this.blockTypeMap.set("grass2",x.NonSolid),this.blockTypeMap.set("stone1",x.Solid)}createBlockInstance(t,e,i){const n=this.blockAnimationMap.get(t),a=this.blockTypeMap.get(t),o=this.createBlock(n,a),s=new c.x({map:o.blockAnimation.texture,color:16777215});s.side=w.ehD,s.transparent=!0;const r=new l.j(s);return r.scale.set(50,50,1),o.setSprite(r),r.position.set(i.x,i.y,i.z),e.add(r),this.blockInstances.push(o),a===x.Solid&&this.solidBlocksInstances.push(o),o}},F=new n.x,E=new a.i(window.innerWidth/-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2,1,1e3);E.position.z=10;const T=new o.C;T.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(T.domElement);const D=new(p());function R(t){A=(t-v)/1e3,function(t){!function(t){if(function(t){for(let t=0;t<M.solidBlocksInstances.length;t++){const e=M.solidBlocksInstances[t],i=B.sprite.position.x-50+B.emptyCollisionPixels.left,n=B.sprite.position.x+50-B.emptyCollisionPixels.right,a=B.sprite.position.y+50-B.emptyCollisionPixels.top,o=B.sprite.position.y-50+B.emptyCollisionPixels.bottom,s=e.sprite.position.x-25,r=e.sprite.position.x+25,c=e.sprite.position.y+25,l=e.sprite.position.y-25;i<r&&n>s&&a>l&&o<c&&(B.sprite.position.x-=B.velocity.x,B.sprite.position.y-=B.velocity.y)}}(),!B.attacking){B.flipped=function(){let t=B.flipped;return!C.LEFT||C.UP||C.DOWN?(C.RIGHT||C.UP||C.DOWN)&&(t=!1):t=!0,t}();let e=B.speed*t;C.LEFT?(B.velocity.x=-e,h.currentAnimation="walkRight",h.mostRecentDirection="right"):C.RIGHT&&(B.velocity.x=e,h.currentAnimation="walkRight",h.mostRecentDirection="right"),C.UP?(B.velocity.y=e,h.currentAnimation="walkBack",h.mostRecentDirection="back"):C.DOWN&&(B.velocity.y=-e,h.currentAnimation="walk",h.mostRecentDirection="normal"),C.SPACE&&!B.attacking&&(B.attacking=!0,console.log(2*t),B.velocity.x/=B.slowDownCoefficientOnAttack*(1+t),B.velocity.y/=B.slowDownCoefficientOnAttack*(1+t),"normal"===h.mostRecentDirection?h.currentAnimation="attack":"back"===h.mostRecentDirection?h.currentAnimation="attackBack":"right"===h.mostRecentDirection?h.currentAnimation="attackRight":h.currentAnimation="attack")}B.velocity.x*=B.speedFrictionRatio*(1-t),Math.abs(B.velocity.x)<.01*t&&(B.velocity.x=0),B.velocity.y*=B.speedFrictionRatio*(1-t),Math.abs(B.velocity.y)<.01*t&&(B.velocity.y=0);let e=B.attacking;Object.keys(C).forEach((t=>{C[t]&&(e=!0)})),e||0!==B.velocity.x||0!==B.velocity.y||("normal"===h.mostRecentDirection?h.currentAnimation="idle":"back"===h.mostRecentDirection?h.currentAnimation="idleBack":"right"===h.mostRecentDirection?h.currentAnimation="idleRight":h.currentAnimation="idle"),B.sprite.position.x+=B.velocity.x,B.sprite.position.y+=B.velocity.y}(t)}(A),t<v+1e3/120||(v=t,D.begin(),O(),D.end()),window.requestAnimationFrame(R)}function O(){b.updateAnimations(),M.updateBlocks(),T.render(F,E)}window.addEventListener("resize",(function(){E.left=window.innerWidth/-2,E.right=window.innerWidth/2,E.top=window.innerHeight/2,E.bottom=window.innerHeight/-2,E.updateProjectionMatrix(),T.setSize(window.innerWidth,window.innerHeight),O()}),!1);const B={sprite:null,flipped:!1,velocity:new s.F(0,0),speed:100,speedFrictionRatio:.9,textures:[],attacking:!1,slowDownCoefficientOnAttack:.1,emptyCollisionPixels:{top:45,bottom:11,left:35,right:35}},C={UP:!1,DOWN:!1,LEFT:!1,RIGHT:!1,SPACE:!1};function P(t){switch(t.code){case"ArrowLeft":C.LEFT=!0,C.RIGHT=!1;break;case"ArrowRight":C.RIGHT=!0,C.LEFT=!1;break;case"ArrowUp":C.UP=!0,C.DOWN=!1;break;case"ArrowDown":C.DOWN=!0,C.UP=!1;break;case"Space":C.SPACE=!0}}function S(t){switch(t.code){case"ArrowLeft":C.LEFT=!1;break;case"ArrowRight":C.RIGHT=!1;break;case"ArrowUp":C.UP=!1;break;case"ArrowDown":C.DOWN=!1;break;case"Space":C.SPACE=!1}}function N(){document.getElementById("help-text").style.display="none",window.removeEventListener("keydown",N)}window.addEventListener("DOMContentLoaded",(()=>{!function(){const t=document.createElement("div");t.innerHTML="Use the arrow keys to move and space to attack",t.style.position="absolute",t.style.top="50%",t.style.left="50%",t.style.transform="translate(-50%, -50%)",t.style.color="white",t.style.fontSize="20px",t.style.fontFamily="sans-serif",t.style.zIndex="1",t.id="help-text",document.body.appendChild(t),window.addEventListener("keydown",N)}(),document.body.appendChild(D.dom),D.showPanel(0),function(){const t=(new r.d).load("static/background.jpg"),e=new c.x({map:t,color:16777215}),i=new l.j(e);i.scale.set(2e3,1e3,1),i.position.set(0,0,-5),F.add(i)}();const t=(new r.d).load("static/character.png",(async e=>{const i=function(t,e,i=1,n=1){const a=f(t,i,n).reverse();a.forEach((t=>{t.wrapS=w.rpg}));const o=new c.x({map:a[0],color:16777215});o.side=w.ehD,o.transparent=!0;const s=new l.j(o);return s.scale.set(k,k,1),e.add(s),{sprite:s,textures:a}}(t,F,h.x_tiles,h.y_tiles);B.sprite=i.sprite,B.textures=i.textures,window.addEventListener("keydown",P),window.addEventListener("keyup",S),b=new u(B),await M.createBlockAnimationMap(),M.createBlockTypeMap();const n=window.innerWidth,a=window.innerHeight,o=50,s=new m.P(-n/2+25,a/2-25,-1);for(let t=0;t<n/o;t++)for(let e=0;e<a/o;e++)(t+e)%2==0?M.createBlockInstance("grass1",F,new m.P(s.x+t*o,s.y-e*o,s.z)):M.createBlockInstance("grass2",F,new m.P(s.x+t*o,s.y-e*o,s.z));M.createBlockInstance("stone1",F,new m.P(s.x+100,s.y-100,s.z)),window.requestAnimationFrame(R)}),(t=>{const e=document.createElement("div");e.style.position="absolute",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",e.innerText=`${Math.round(t.loaded/t.total*100)}%`,document.body.appendChild(e)}),(t=>{console.error("Unexpected error while loading texture: ",t);const e=document.createElement("div");e.style.position="absolute",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",e.innerText="Unexpected error while loading texture",document.body.appendChild(e)}))}))}},i={};function n(t){var a=i[t];if(void 0!==a)return a.exports;var o=i[t]={exports:{}};return e[t].call(o.exports,o,o.exports,n),o.exports}n.m=e,t=[],n.O=(e,i,a,o)=>{if(!i){var s=1/0;for(m=0;m<t.length;m++){for(var[i,a,o]=t[m],r=!0,c=0;c<i.length;c++)(!1&o||s>=o)&&Object.keys(n.O).every((t=>n.O[t](i[c])))?i.splice(c--,1):(r=!1,o<s&&(s=o));if(r){t.splice(m--,1);var l=a();void 0!==l&&(e=l)}}return e}o=o||0;for(var m=t.length;m>0&&t[m-1][2]>o;m--)t[m]=t[m-1];t[m]=[i,a,o]},n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t={179:0};n.O.j=e=>0===t[e];var e=(e,i)=>{var a,o,[s,r,c]=i,l=0;if(s.some((e=>0!==t[e]))){for(a in r)n.o(r,a)&&(n.m[a]=r[a]);if(c)var m=c(n)}for(e&&e(i);l<s.length;l++)o=s[l],n.o(t,o)&&t[o]&&t[o][0](),t[o]=0;return n.O(m)},i=self.webpackChunk=self.webpackChunk||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))})();var a=n.O(void 0,[374],(()=>n(196)));a=n.O(a)})();